server:
  port: 8080
  address: www.myproject.local
  reactive:
    session:
      cookie:
        secure: false       # requires HTTPS in production. Note: secure: true requires HTTPS. For local dev, you may temporarily set secure: false.
        http-only: true    # prevents JS access
        domain: myproject.local
eureka:
  client:
    serviceUrl:
      defaultZone: http://www.myproject.local:8761/eureka # Replace with your Eureka server address
    fetchRegistry: true
    registerWithEureka: false # Gateway typically doesn't need to register itself if it's only consuming services
  instance:
    preferIpAddress: true # Optional: prefer IP address over hostname for registration
spring:
  application:
      name: fountation-gateway-service
  main:
    web-application-type: reactive
  cloud:
    gateway:
      default-filters:
        - TokenRelay
      routes:
        - id: fountation-user-service
          uri: lb://fountation-user-service # MY-SERVICE-ID is the application name of your microservice in Eureka
          predicates:
            - Path=/user/** # Define the path predicate for this route
          filters:
            - RemoveRequestHeader=favicon.ico
            - RemoveRequestHeader=default-ui.css
      globalcors:
        corsConfigurations:
          '[/**]': # Apply CORS to all routes
            allowedOrigins:
              - "http://www.myproject.local:5173"  # Your frontend origin(s)
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowedHeaders:
              - Content-Type
              - Authorization
              - X-Requested-With
            allowCredentials: true
            maxAge: 3600
  security:
    oauth2:
      client:
        registration:
          # A unique identifier for your client registration (e.g., 'internal-auth-server')
          auth0:
            client-id: XXXXXXXXXXXXXXXX # Must be registered in your Auth Server DB/config
            client-secret: XXXXXXXXXXXXXXXXXXXXXXXXXX  # Must match what's in your Auth Server DB/config
            authorization-grant-type: authorization_code
            redirect-uri: http://www.myproject.local:8080/login/oauth2/code/auth0
            scope: openid,profile,email
            provider: auth0
            client-name: Auth0
        provider:
          # Matches the registration ID above
          auth0:
            # Point this to the base URL of your OWN Spring Authorization Server application
            #issuer-uri: https://dev-XXXXXXXXX.us.auth0.com/
            authorization-uri: https://dev-XXXXXXXXXXXX.us.auth0.com/authorize?audience=https://dev-XXXXXXXXXXXXX.us.auth0.com/api/v2/
            token-uri: https://dev-XXXXXXXXXXXXX.us.auth0.com/oauth/token
            user-info-uri: https://dev-XXXXXXXXXXXX.us.auth0.com/userinfo
            jwk-set-uri: https://dev-XXXXXXXXXXXX.us.auth0.com/.well-known/jwks.json
            issuer-uri: https://dev-XXXXXXXXXXXXXXXX.us.auth0.com/
      resource-server:
        jwt:
          # Spring Security automatically appends /.well-known/openid-configuration
          # to this URI to discover the JWK set URI needed for validation
          issuer-uri: https://dev-XXXXXXXXXXXXXXX.us.auth0.com/
          audiences:
            - https://dev-XXXXXXXXXXXXXX.us.auth0.com/api/v2/
logging:
  level:
    org:
      springframework:
        security:
          oauth2:
            client: DEBUG
        web:
          reactive:
            function:
              client:
                ExchangeFunctions: DEBUG
          server:
            util:
              matcher: INFO